
          
    SELECT
    cj."id",
    cj.job_setup_name,
    emp_cart.first_name || ' ' || emp_cart.last_name AS cart_operator_name,
		emp_truck.first_name || ' ' || emp_truck.last_name AS truck_driver_name,
		emp_crew_chief.first_name || ' ' || emp_crew_chief.last_name AS crew_cheif_name,
    ht.trucking_company,
    cj.farm_id AS farm_id,
    cj.crop_acres AS acres,
    cj.crop_gps_acres AS gps_acres,
    cj.crop_id AS crop_id,
    ht.id as "delivery_ticket_id",
    ht.delivery_ticket_name::TEXT AS ticket_name,
    ht.scale_ticket_number AS sl_number,
    ht.loaded_miles AS load_miles,
    ht.ticket_status AS status,

    CAST (
	  COALESCE (
		  CASE
				
				WHEN ht.farmers_bin_weight NOT IN ( '', '0', 'null' ) THEN
				ht.farmers_bin_weight 
			END,
		  
      CASE
				
				WHEN ht.scale_ticket_weight NOT IN ( '', '0', 'null' ) THEN
				ht.scale_ticket_weight 
				END,
			'0'
			) AS NUMERIC    ) AS net_pounds,	
  
    ht.created_at AS load_date,
    ht.protein_content AS protein,
    ht.moisture_content AS moisture,
    ht.test_weight,
    ht.field_id::TEXT,
    cd."id" AS destination_id,
    cf."name" AS farm_name,
    field."name" AS field_name,
    cd."name" AS destination,
    C.name AS crop_name,
    C.bushel_weight AS bushel_weight,
    emp_truck.guest_user_type

    FROM
    "Customer_Job_Setup" cj
    LEFT JOIN "Harvesting_Delivery_Ticket" ht ON ht.job_id = cj."id" AND ht.is_deleted != TRUE
    LEFT JOIN "Customer_Farm" cf ON cj.farm_id = cf.ID AND cf.is_deleted = FALSE AND cf.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Customer_Field" field ON ht.field_id = field."id" AND field.is_deleted = FALSE AND field.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Customer_Destination" cd ON ht.destination_id = cd.ID AND cd.is_deleted = FALSE AND cd.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Crops" C ON cj.crop_id = C."id"
    LEFT JOIN "Employees" emp_cart ON emp_cart.id = ht.kart_operator_id
		LEFT JOIN "Employees" emp_truck ON emp_truck.id = ht.truck_driver_id
		LEFT JOIN "Employees" emp_crew_chief ON emp_crew_chief.id = cj.crew_chief_id
    WHERE cj.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'  AND cj.is_deleted = FALSE AND ht.is_deleted != TRUE AND ht.field_id IS NOT NULL

        
    UNION ALL

    SELECT
    cj."id",
    cj.job_setup_name,
    emp_cart.first_name || ' ' || emp_cart.last_name AS cart_operator_name,
		emp_truck.first_name || ' ' || emp_truck.last_name AS truck_driver_name,
		emp_crew_chief.first_name || ' ' || emp_crew_chief.last_name AS crew_cheif_name,
    ht.trucking_company,
    cj.farm_id AS farm_id,
    cj.crop_acres AS acres,
    cj.crop_gps_acres AS gps_acres,
    cj.crop_id AS crop_id,
    ht.id as "delivery_ticket_id",
    concat(ht.delivery_ticket_name, '-SL')::TEXT AS ticket_name,
    ht.scale_ticket_number AS sl_number,
    ht.loaded_miles AS load_miles,
    ht.ticket_status AS status,
    
    CASE
    WHEN NULLIF(NULLIF(ht.scale_ticket_weight, '')::NUMERIC, 0) IS NULL THEN 0
    ELSE CAST(NULLIF(NULLIF(ht.scale_ticket_weight, '')::NUMERIC, 0) AS NUMERIC)
    - COALESCE(NULLIF(NULLIF(ht.split_cart_scale_weight, '')::NUMERIC, 0), 0)
    END AS net_pounds,

    ht.created_at AS load_date,
    ht.protein_content AS protein,
    ht.moisture_content AS moisture,
    ht.test_weight,
    ht.split_field_id,
    cd."id" AS destination_id,
    cf."name" AS farm_name,
    field."name" AS field_name,
    cd."name" AS destination,
    C.name AS crop_name,
    C.bushel_weight AS bushel_weight,
    emp_truck.guest_user_type

        
        FROM
    "Customer_Job_Setup" cj
    LEFT JOIN "Harvesting_Delivery_Ticket" ht ON ht.job_id = cj."id" AND ht.is_deleted != TRUE
    LEFT JOIN "Customer_Farm" cf ON cj.farm_id = cf.ID AND cf.is_deleted = FALSE AND cf.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Customer_Field" field ON CAST(ht.split_field_id AS UUID) = field."id" AND field.is_deleted = FALSE AND field.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Customer_Destination" cd ON ht.destination_id = cd.ID AND cd.is_deleted = FALSE AND cd.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    LEFT JOIN "Crops" C ON cj.crop_id = C."id"
    LEFT JOIN "Employees" emp_cart ON emp_cart.id = ht.kart_operator_id
		LEFT JOIN "Employees" emp_truck ON emp_truck.id = ht.truck_driver_id
		LEFT JOIN "Employees" emp_crew_chief ON emp_crew_chief.id = cj.crew_chief_id
    WHERE cj.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'  AND cj.is_deleted = FALSE AND ht.is_deleted != TRUE AND ht.field_id IS NOT NULL

    AND ht.split_load_check = TRUE

    ORDER BY 
              load_Date desc

              OFFSET 
              0
        LIMIT 
              10;
    ;
     
    SELECT DISTINCT
(
  SELECT 
  SUM(CAST(
    CASE
      WHEN ht.scale_ticket_weight = 'null' THEN 0
      ELSE ht.scale_ticket_weight::NUMERIC
    END AS NUMERIC
  )) AS total_net_pounds
FROM "Harvesting_Delivery_Ticket" ht
 Where ht.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND ht.field_id IS NOT NULL
AND ht.is_deleted != TRUE
AND ht.scale_ticket_weight IS NOT NULL
AND ht.scale_ticket_weight <> '' 


) AS total_net_pounds,
(
  SELECT 
      SUM(net_pounds / NULLIF(bushel_weight, 0)) 
  FROM 
  (
      SELECT
    CASE
      WHEN COALESCE(NULLIF(ht.farmers_bin_weight, ''), NULLIF(ht.scale_ticket_weight, '')) = '' THEN 0
      ELSE
        CASE
          WHEN NULLIF(ht.farmers_bin_weight, '') IS NULL THEN 0
          ELSE CAST(COALESCE(NULLIF(ht.farmers_bin_weight, ''), NULLIF(ht.scale_ticket_weight, '')) AS NUMERIC)
        END
    END AS net_pounds,
          C.bushel_weight
      FROM "Customer_Job_Setup" cj, "Harvesting_Delivery_Ticket" ht, "Crops" C
      WHERE 
          ht.job_id = cj."id" 
          AND cj.crop_id = C."id" 
          AND cj.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' 
          AND cj.is_deleted = FALSE 
          AND ht.is_deleted != TRUE
          AND ht.field_id IS NOT NULL

      UNION ALL
      SELECT
          CAST ( COALESCE ( NULLIF ( ht.scale_ticket_weight, '' ), '0' ) AS NUMERIC ) - CAST ( COALESCE ( NULLIF ( ht.split_cart_scale_weight, '' ), '0' ) AS NUMERIC ) AS net_pounds,
          C.bushel_weight
      FROM "Customer_Job_Setup" cj, "Harvesting_Delivery_Ticket" ht, "Crops" C
      WHERE 
          ht.job_id = cj."id" 
          AND cj.crop_id = C."id" 
          AND cj.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' 
          AND cj.is_deleted = FALSE 
          AND ht.is_deleted != TRUE 
          AND ht.split_load_check = TRUE
          AND ht.field_id IS NOT NULL
  ) AS CombinedResults
) AS total_net_bushels,

  (SELECT SUM(crop_acres) 
   FROM (
       SELECT DISTINCT ON (cj."id")
       CAST(NULLIF(cj.crop_acres, 'null') AS NUMERIC) as crop_acres
       FROM "Customer_Job_Setup" cj 
       LEFT JOIN "Harvesting_Delivery_Ticket" ht ON ht.job_id = cj."id"

       WHERE
    cj.is_deleted = FALSE 
    AND ht.is_deleted != TRUE
    AND cj.crop_acres IS NOT NULL 
    AND cj.crop_acres <> '' 
    AND ht.field_id IS NOT NULL
     AND cj.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'

) sub
  ) AS total_acres,
    (
    SELECT count(id) AS total_tickets
    from "Harvesting_Delivery_Ticket" ht 
     WHERE ht.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND ht.is_deleted != TRUE AND ht.field_id IS NOT NULL
    ),

    (Select count(hdt.id) AS total_dht_loads 
		from "Harvesting_Delivery_Ticket" hdt
		LEFT JOIN "Employees" td ON td.id = hdt.truck_driver_id AND hdt.is_deleted != TRUE AND hdt.field_id IS NOT NULL 
		WHERE hdt.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND td.is_guest_user = FALSE
		),
		
		(Select count(hdt.id) AS total_customer_loads 
		from "Harvesting_Delivery_Ticket" hdt
		LEFT JOIN "Employees" td ON td.id = hdt.truck_driver_id AND hdt.is_deleted != TRUE AND hdt.field_id IS NOT NULL
		LEFT JOIN "Customers" cust ON cust.id = hdt.customer_id AND cust.is_deleted != TRUE
		WHERE hdt.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND td.is_guest_user = TRUE AND td.trucking_company = cust."customer_name"
		),

    (Select SUM(hdt.loaded_miles::FLOAT) AS dht_total_loaded_miles 
		from "Harvesting_Delivery_Ticket" hdt
		LEFT JOIN "Employees" td ON td.id = hdt.truck_driver_id AND hdt.is_deleted != TRUE AND hdt.field_id IS NOT NULL AND hdt.loaded_miles <> '' AND hdt.loaded_miles IS NOT NULL
		WHERE hdt.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND td.is_guest_user = FALSE
		),
		
			(Select SUM(hdt.loaded_miles::FLOAT)/count(hdt.loaded_miles) AS dht_average_loaded_miles 
		from "Harvesting_Delivery_Ticket" hdt
		LEFT JOIN "Employees" td ON td.id = hdt.truck_driver_id AND hdt.is_deleted != TRUE AND hdt.field_id IS NOT NULL AND hdt.loaded_miles <> '' AND hdt.loaded_miles IS NOT NULL
		WHERE hdt.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND td.is_guest_user = FALSE
		)

FROM
"Customer_Job_Setup" cj
LEFT JOIN "Crops" cc ON cc."id" = uuid(cj.crop_id)
LEFT JOIN "Customer_Farm" cf ON cf."id" = cj.farm_id
LEFT JOIN "Harvesting_Delivery_Ticket" ht ON ht.job_id = cj."id"
LEFT JOIN "Customer_Field" field ON "field".ID = ht.field_id
LEFT JOIN "Customer_Destination" cd ON cd."name" = ht.destination
LEFT JOIN "Customers" customers ON customers."id" = ht.customer_id
   Where ht.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
    AND ht.is_deleted != TRUE
    AND cj.is_deleted = FALSE
    AND field.is_deleted = FALSE
    AND cd.is_deleted = FALSE
    AND cc.is_deleted = FALSE
    AND ht.field_id IS NOT NULL
    

;
  