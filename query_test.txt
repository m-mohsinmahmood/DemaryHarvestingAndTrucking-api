
        Select 
        
        customer.id AS customer_id,
        customer.customer_name AS customer_name,
        cjs.job_setup_name AS job_name,
        cjs.farm_id AS farm_id,
        cf."name" AS farm_name,
        crop.id AS crop_id,
        crop."name" AS crop_name,
        'acre' AS rate_type,
        cjs.crop_acres AS quantity,
        cr.combining_rate AS rate,
        (cjs.crop_acres::float * cr.combining_rate::float) AS revenue,
        (cjs.crop_acres::float * cr.combining_rate::float)/cjs.crop_acres::float AS revenue_per_acre,
        calculate_weight(cjs.id) / crop.bushel_weight AS revenue_per_bushel
        
        
        from
        
        "Customer_Job_Setup" cjs
        INNER JOIN "Customers" customer ON cjs.customer_id = customer."id"
        INNER JOIN "Customer_Farm" cf ON cjs.farm_id = cf."id" AND cf.is_deleted = FALSE 
        INNER JOIN "Crops" crop ON cjs.crop_id = crop."id"
        INNER JOIN "Combining_Rates" cr ON cr.customer_id = cjs.customer_id AND cjs.farm_id = cr.farm_id AND cjs.crop_id = cr.crop_id AND cr.is_deleted = FALSE 
        
        where cjs.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548' AND cjs.is_job_completed = TRUE
        ; 
        WITH cte AS (
            SELECT
                customer.id AS customer_id,
                customer.customer_name AS customer_name,
                cjs.job_setup_name AS job_name,
                cjs.farm_id AS farm_id,
                cf."name" AS farm_name,
                crop.id AS crop_id,
                crop."name" AS crop_name,
                hr.rate_type AS rate_type,
                cjs.crop_acres::float AS crop_acres,
                calculate_weight(cjs.id) / crop.bushel_weight AS revenue_per_bushel,
                CASE
                    WHEN hr.rate_type = 'Bushels' THEN calculate_weight(cjs.id) / crop.bushel_weight
                    WHEN hr.rate_type = 'Bushels + Excess Yields' THEN ( calculate_weight(cjs.id) / crop.bushel_weight) + ((calculate_weight(cjs.id) / crop.bushel_weight) - (cjs.crop_acres::NUMERIC * hr.base_rate))
                    WHEN hr.rate_type = 'Hundred Weight' THEN calculate_weight(cjs.id) / 100
                    WHEN hr.rate_type = 'Miles' THEN (SELECT SUM(COALESCE(NULLIF(loaded_miles, '')::INTEGER, 0)) FROM "Harvesting_Delivery_Ticket" hdt WHERE hdt.job_id = cjs.id)
                    WHEN hr.rate_type = 'Ton Miles' THEN calculate_weight(cjs.id) / 2000
                    WHEN hr.rate_type = 'Tons' THEN calculate_weight(cjs.id) / 2000
                    WHEN hr.rate_type = 'Load Count' THEN (SELECT COUNT(hdt.id) FROM "Harvesting_Delivery_Ticket" hdt WHERE hdt.job_id = cjs.id)
                    ELSE 0
                END AS quantity,
                hr.rate AS rate,
                hr.base_bushels AS base_bushels,
                hr.base_rate AS base_rate,
                hr.premium_rate AS premium_rate,
                CASE
                    WHEN hr.rate_type = 'Bushels' THEN ( calculate_weight(cjs.id) / crop.bushel_weight) * hr.rate
                    WHEN hr.rate_type = 'Bushels + Excess Yields' THEN ( ( calculate_weight(cjs.id) / crop.bushel_weight) * hr.premium_rate ) + ( ( ( calculate_weight(cjs.id) / crop.bushel_weight) - (cjs.crop_acres::NUMERIC * hr.base_bushels) ) * hr.premium_rate )
                    WHEN hr.rate_type = 'Hundred Weight' THEN (calculate_weight(cjs.id) / 100) * hr.rate
                    WHEN hr.rate_type = 'Miles' THEN (SELECT SUM(COALESCE(NULLIF(loaded_miles, '')::INTEGER, 0)) FROM "Harvesting_Delivery_Ticket" hdt WHERE hdt.job_id = cjs.id) * hr.rate
                    WHEN hr.rate_type = 'Ton Miles' THEN (SELECT (hr.premium_rate * (SUM(COALESCE(NULLIF(loaded_miles, '')::INTEGER, 0)) / COUNT(hdt.id)) + hr.base_rate) * (calculate_weight(cjs.id) / 2000) FROM "Harvesting_Delivery_Ticket" hdt WHERE hdt.job_id = cjs.id)
                    WHEN hr.rate_type = 'Tons' THEN (calculate_weight(cjs.id) / 2000) * hr.rate
                    WHEN hr.rate_type = 'Load Count' THEN (SELECT COUNT(hdt.id) FROM "Harvesting_Delivery_Ticket" hdt WHERE hdt.job_id = cjs.id) * hr.rate
                    ELSE 0
                END AS revenue
            FROM
                "Customer_Job_Setup" cjs
                INNER JOIN "Customers" customer ON cjs.customer_id = customer.ID
                INNER JOIN "Customer_Farm" cf ON cjs.farm_id = cf.id AND cf.is_deleted = FALSE
                INNER JOIN "Crops" crop ON cjs.crop_id = crop.ID
                INNER JOIN "Hauling_Rates" hr ON cjs.customer_id = hr.customer_id AND cjs.farm_id = hr.farm_id AND cjs.crop_id = hr.crop_id AND hr.is_deleted = FALSE
            WHERE
                cjs.customer_id = 'd32ea967-77d0-48a2-9c41-1c2e2ed9f548'
                AND cjs.is_job_completed = TRUE
        )
        SELECT
            *,
            revenue / crop_acres AS revenue_per_acre,
            revenue_per_bushel
            
        FROM
            cte;
        